<!DOCTYPE html>
<html>
<head>
    <title>Test Job Card Update</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { background: #f5f5f5; padding: 20px; margin: 10px 0; border-radius: 8px; }
        button { background: #5c6bc0; color: white; border: none; padding: 10px 20px; margin: 5px; border-radius: 4px; cursor: pointer; }
        pre { background: #fff; padding: 10px; border: 1px solid #ddd; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>Job Card Update Test</h1>
    
    <div class="test-section">
        <h3>Step 1: Fetch Job Cards</h3>
        <button onclick="fetchJobCards()">Fetch All Job Cards</button>
        <pre id="jobCardsList"></pre>
    </div>
    
    <div class="test-section">
        <h3>Step 2: Test Update</h3>
        <label>Job Card ID: <input type="text" id="testJobCardId" value="JC001" /></label><br><br>
        <button onclick="testUpdate()">Test Update Job Card</button>
        <pre id="updateResult"></pre>
    </div>
    
    <div class="test-section">
        <h3>Step 3: Verify Update</h3>
        <button onclick="verifyUpdate()">Check Updated Job Card</button>
        <pre id="verifyResult"></pre>
    </div>

    <script>
        async function fetchJobCards() {
            const output = document.getElementById('jobCardsList');
            output.textContent = 'Loading...';
            
            try {
                const response = await fetch('/api/data/job_cards');
                const result = await response.json();
                
                if (result.success) {
                    // Show first 5 job cards
                    const firstFive = result.data.slice(0, 5);
                    output.textContent = JSON.stringify(firstFive, null, 2);
                } else {
                    output.textContent = 'Error: ' + result.error;
                }
            } catch (error) {
                output.textContent = 'Error: ' + error.message;
            }
        }
        
        async function testUpdate() {
            const output = document.getElementById('updateResult');
            const jobCardId = document.getElementById('testJobCardId').value;
            output.textContent = 'Updating...';
            
            const updateData = {
                JobCard_ID: jobCardId,
                Status: 'Closed',
                Closed_Date: new Date().toISOString().split('T')[0],
                Test_Update: 'Updated at ' + new Date().toLocaleTimeString()
            };
            
            try {
                const response = await fetch('/api/data/job_cards', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(updateData)
                });
                
                const result = await response.json();
                output.textContent = JSON.stringify(result, null, 2);
            } catch (error) {
                output.textContent = 'Error: ' + error.message;
            }
        }
        
        async function verifyUpdate() {
            const output = document.getElementById('verifyResult');
            const jobCardId = document.getElementById('testJobCardId').value;
            output.textContent = 'Checking...';
            
            try {
                const response = await fetch('/api/debug/jobcard/' + jobCardId);
                const result = await response.json();
                output.textContent = JSON.stringify(result, null, 2);
            } catch (error) {
                output.textContent = 'Error: ' + error.message;
            }
        }
    </script>
</body>
</html>